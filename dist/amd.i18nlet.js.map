{"version":3,"file":"amd.i18nlet.js","sources":["../src/index.js"],"sourcesContent":["/*global VERSION*/\n\nconst debug = false;\nconst defaultLangage = 'en';\nconst langageSeparator = ':';\nconst variableKeyPrefix = '{{';\nconst variableKeySuffix = '}}';\nconst defaultNoConvertVariable = null;\n/**\n * console output\n *\n * @param {String} type level\n * @param {*} args output messages\n */\nconst _output = (type, ...args) => {\n  args.unshift(`[${type.toUpperCase()}]`);\n  args.unshift('[i18nlet]');\n\n  try {\n    console.log.apply(console, args); // eslint-disable-line\n  } catch (e) {\n    console.log(args); // eslint-disable-line\n  }\n};\n\n\n/**\n * @class I18nlet\n */\nclass I18nlet {\n\n  /**\n   * Creates an instance of I18nlet.\n   * @memberof I18nlet\n   */\n  constructor(settings = {}) {\n    this.version = VERSION || '';\n    this.k2v = {};\n\n    ///\n    this.settings = {};\n    this.settings.currentLangage = this.settings.defaultLangage = settings.defaultLangage || defaultLangage;\n    this.settings.langageSeparator = settings.langageSeparator || langageSeparator;\n    this.settings.debug = settings.debug || debug;\n\n    this.settings.variableKeyPrefix = settings.variableKeyPrefix || variableKeyPrefix;\n    this.settings.variableKeySuffix = settings.variableKeySuffix || variableKeySuffix;\n    this.settings.defaultNoConvertVariable = settings.defaultNoConvertVariable || defaultNoConvertVariable;\n\n    this.regexpStr = `${this.settings.variableKeyPrefix}(.+?)${this.settings.variableKeySuffix}`;\n    this.regexp = new RegExp(this.regexpStr, 'g');\n\n\n    this.logger = {};\n    this.logger.output = settings.output || _output;\n    /**\n     * console debug output\n     * @param {*} args\n     */\n    this.logger.debug = (...args) => {\n      if (!this.settings.debug) {\n        return;\n      }\n      args.unshift('DEBUG');\n      this.logger.output.apply(null, args);\n    };\n\n    /**\n     * console error output\n     * @param {*} message\n     */\n    this.logger.error = message => {\n      const err = new Error(`[i18nlet] ${message}`);\n      this.logger.output.apply(null, ['ERROR', err]);\n      throw err;\n    };\n\n    ///\n  }\n\n\n  load(langage, terms) {\n    Object.keys(terms).forEach(context => {\n      this.k2v[`${langage}${this.settings.langageSeparator}${context}`] = terms[context];\n    });\n  }\n\n  loads(data) {\n    Object.keys(data).forEach(v => {\n      this.load(v, data[v]);\n    });\n  }\n\n  changeLangage(langage) {\n    this.settings.currentLangage = langage || this.settings.defaultLangage;\n  }\n\n  currentLangage() {\n    return this.settings.currentLangage;\n  }\n\n  i(context, vals, options) {\n    vals = vals || {};\n    options = options || {};\n    options.ref = !!options.ref;\n    options.langage = options.langage ? options.langage : this.currentLangage();\n\n\n    const ctx = `${options.langage}${this.settings.langageSeparator}${context}`;\n    const value = this.k2v[ctx];\n\n    if (!value) {\n      this.logger.debug(`Context not found. '${context}' for '${ctx}'`);\n    }\n\n    let ret = value;\n    let match;\n    while (match = this.regexp.exec(ret)) { // eslint-disable-line\n      const val = vals[match[1].trim()];\n      if (!val) {\n        this.logger.debug(`It can not convert the variable part. '${match[0]}' for '${ret}'`);\n        ret = (typeof this.settings.defaultNoConvertVariable === 'string') ? ret.replace(match[0], this.settings.defaultNoConvertVariable) : ret;\n        continue;\n      }\n\n      ret = ret.replace(match[0], val);\n      this.regexp.lastIndex = 0;\n    }\n\n    if (!options.ref) {\n      return ret;\n    }\n\n    let matchRef;\n    while (matchRef = this.regexp.exec(ret)) { // eslint-disable-line\n      const ctxRef = `${options.langage || this.currentLangage()}${this.settings.langageSeparator}${matchRef[1].trim()}`;\n      const valRef = this.k2v[ctxRef];\n      if (!valRef) {\n        this.logger.debug(`It can not convert the constant part. '${matchRef[0]}' for '${ret}'`);\n        ret = (typeof this.settings.defaultNoConvertVariable === 'string') ? ret.replace(matchRef[0], this.settings.defaultNoConvertVariable) : ret;\n        continue;\n      }\n\n      ret = ret.replace(matchRef[0], valRef);\n      this.regexp.lastIndex = 0;\n\n    }\n\n    return ret;\n\n  }\n\n}\n\nexport default I18nlet;\n"],"names":["const","this"],"mappings":"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"}