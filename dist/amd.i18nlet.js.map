{"version":3,"file":"amd.i18nlet.js","sources":["../src/index.js"],"sourcesContent":["/*global VERSION*/\n\nconst debug = false;\nconst defaultLangage = 'en';\nconst langageSeparator = ':';\nconst variableKeyPrefix = '{{';\nconst variableKeySuffix = '}}';\nconst defaultNoConvertVariable = null;\nconst defaultText = '';\nconst defaultGetMessageFunctionName = 'i';\nconst defaultReference = true;\n\n/**\n * console output\n *\n * @param {String} type level\n * @param {*} args output messages\n */\nconst _output = (type, ...args) => {\n  args.unshift(`[${type.toUpperCase()}]`);\n  args.unshift('[i18nlet]');\n\n  try {\n    console.log.apply(console, args); // eslint-disable-line\n  } catch (e) {\n    console.log(args); // eslint-disable-line\n  }\n};\n\nconst defaultLoad = function (langage, terms) {\n  Object.keys(terms).forEach(context => {\n    this.k2v[`${langage}${this.settings.langageSeparator}${context}`] = terms[context];\n  });\n};\n\nconst defaultLoads = function (data) {\n  Object.keys(data).forEach(v => {\n    this.load(v, data[v]);\n  });\n};\n\n\n/**\n * @class I18nlet\n */\nclass I18nlet {\n\n  /**\n   * Creates an instance of I18nlet.\n   * @memberof I18nlet\n   */\n  constructor(settings = {}) {\n    this.version = VERSION || '';\n    this.k2v = {};\n\n    ///\n    this.settings = {};\n    this.settings.currentLangage = this.settings.defaultLangage = settings.defaultLangage || defaultLangage;\n    this.settings.langageSeparator = settings.langageSeparator || langageSeparator;\n    this.settings.debug = settings.debug || debug;\n\n    this.settings.variableKeyPrefix = settings.variableKeyPrefix || variableKeyPrefix;\n    this.settings.variableKeySuffix = settings.variableKeySuffix || variableKeySuffix;\n    this.settings.noConvertVariable = settings.noConvertVariable || defaultNoConvertVariable;\n\n    this.settings.reference = defaultReference;\n    if ((typeof settings.reference) === 'boolean') {\n      this.settings.reference = settings.reference;\n    }\n\n    this.settings.defaultText = defaultText;\n    if ((typeof settings.defaultText) === 'string') {\n      this.settings.defaultText = settings.defaultText;\n    }\n\n    this.settings.getMessageFunctionName = settings.getMessageFunctionName || defaultGetMessageFunctionName;\n    this[this.settings.getMessageFunctionName] = this._i18nlet_get_message;\n\n    this.regexpStr = `${this.settings.variableKeyPrefix}(.+?)${this.settings.variableKeySuffix}`;\n    this.regexp = new RegExp(this.regexpStr, 'g');\n\n    this.logger = {};\n    this.logger.output = settings.output || _output;\n    /**\n     * console debug output\n     * @param {*} args\n     */\n    this.logger.debug = (...args) => {\n      if (!this.settings.debug) {\n        return;\n      }\n      args.unshift('DEBUG');\n      this.logger.output.apply(null, args);\n    };\n\n    /**\n     * console error output\n     * @param {*} message\n     */\n    this.logger.error = message => {\n      const err = new Error(`[i18nlet] ${message}`);\n      this.logger.output.apply(null, ['ERROR', err]);\n    };\n\n    this.hook = {\n      load: defaultLoad,\n      loads: defaultLoads,\n    };\n    if (settings.hook && settings.hook.load) {\n      this.logger.debug('hook load()');\n      this.hook.load = settings.hook.load;\n    }\n    if (settings.hook && settings.hook.loads) {\n      this.logger.debug('hook loads()');\n      this.hook.loads = settings.hook.loads;\n    }\n\n    ///\n  }\n\n\n  load(/*langage, terms*/) {\n    this.hook.load.apply(this, arguments);\n    return this;\n  }\n\n  loads(/*data*/) {\n    this.hook.loads.apply(this, arguments);\n    return this;\n  }\n\n  changeLangage(langage) {\n    this.settings.currentLangage = langage || this.settings.defaultLangage;\n  }\n\n  currentLangage() {\n    return this.settings.currentLangage;\n  }\n\n  _getDefaultText(context, text, defaultText) {\n    if ((typeof text) !== 'undefined') {\n      return text;\n    }\n    this.logger.debug(`context not found. context:'${context}'`);\n\n    if ((typeof defaultText) === 'string') {\n      return defaultText;\n    }\n    return this.settings.defaultText;\n  }\n\n  _i18nlet_get_message(context, vals, options) { // eslint-disable-line\n    vals = vals || {};\n    options = options || {};\n\n    if ((typeof options.ref) === 'boolean') {\n      options.ref = !!options.ref;\n    } else {\n      options.ref = this.settings.reference;\n    }\n    options.langage = options.langage ? options.langage : this.currentLangage();\n\n\n    const ctx = `${options.langage}${this.settings.langageSeparator}${context}`;\n    const value = this.k2v[ctx];\n\n    if (!value) {\n      this.logger.debug(`Context not found. '${context}' for '${ctx}'`);\n    }\n\n    let ret = value;\n    let match;\n    while (match = this.regexp.exec(ret)) { // eslint-disable-line\n      const val = vals[match[1].trim()];\n      if (!val) {\n        this.logger.debug(`It can not convert the variable part. '${match[0]}' for '${ret}'`);\n        ret = (typeof this.settings.noConvertVariable === 'string') ? ret.replace(match[0], this.settings.noConvertVariable) : ret;\n        continue;\n      }\n\n      ret = ret.replace(match[0], val);\n      this.regexp.lastIndex = 0;\n    }\n\n    if (!options.ref) {\n      return this._getDefaultText(context, ret, options.defaultText);\n    }\n\n    let matchRef;\n    while (matchRef = this.regexp.exec(ret)) { // eslint-disable-line\n      const ctxRef = `${options.langage || this.currentLangage()}${this.settings.langageSeparator}${matchRef[1].trim()}`;\n      const valRef = this.k2v[ctxRef];\n      if (!valRef) {\n        this.logger.debug(`It can not convert the constant part. '${matchRef[0]}' for '${ret}'`);\n        ret = (typeof this.settings.noConvertVariable === 'string') ? ret.replace(matchRef[0], this.settings.noConvertVariable) : ret;\n        continue;\n      }\n\n      ret = ret.replace(matchRef[0], valRef);\n      this.regexp.lastIndex = 0;\n\n    }\n\n    return this._getDefaultText(context, ret, options.defaultText);\n\n  }\n\n}\n\nexport default I18nlet;\n"],"names":["const","this"],"mappings":"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"}